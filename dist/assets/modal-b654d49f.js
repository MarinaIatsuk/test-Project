import{M as h,u as A,a as O}from"./md5-d3aef2ca.js";const D=document.querySelector(".exit__img");document.querySelector(".exit__text");document.querySelector(".account__btn");const U=window.localStorage.getItem("client"),F=document.querySelector(".account__enter"),b=document.querySelector("#btnOpenBurger"),v=document.querySelector("#personalAccount"),R=document.querySelector(".account__personal"),J=document.querySelector(".account__exit"),H=document.querySelector(".account__avatar"),z=document.querySelector(".search__input"),d=document.querySelector(".search__list"),y=document.querySelector(".burger-menu__exit");X(".burger-menu");U===null?(b.style.display="flex",v.style.display="none",y.style.display="none"):(v.style.display="flex",b.style.display="none",y.style.display="flex");z.addEventListener("input",e=>{const t=e.target.value.toLowerCase();fetch(`https://kinopoiskapiunofficial.tech/api/v2.1/films/search-by-keyword?keyword=${encodeURIComponent(t)}&page=1`,{method:"GET",headers:{"X-API-KEY":"6e01b98a-32ba-41c9-b64f-a2a9582aafa5","Content-Type":"application/json"}}).then(o=>o.json()).then(o=>{d.innerHTML="",o.films.forEach(n=>{if(n.filmId!==void 0&&n.filmId!==null){let l;l=n.nameRu,n.nameRu===void 0&&n.nameEn!==void 0&&(l=n.nameEn);const s=document.createElement("li"),c=`<a href="page-movie.html?id=${n.filmId}" class="list__link">${l}</a>`;s.classList.add("list__item"),s.innerHTML=c,d.appendChild(s)}d.style.display=o.films.length>0?"block":"none",document.addEventListener("click",l=>{!l.target.closest(".search__input")&&!l.target.closest(".search__list")&&(d.style.display="none")})})}).catch(o=>console.log(o))});const G=window.localStorage.getItem("client");JSON.parse(G);D.addEventListener("click",M);y.addEventListener("click",M);function M(){window.localStorage.removeItem("client"),F.style.display="flex",b.style.display="flex",y.style.display="none",v.style.display="none",R.style.display="none",J.style.display="none",window.location.href.includes("personalaccount.html")&&window.open(window.location.protocol+"//"+window.location.host+"/","_self")}H.addEventListener("click",K);function K(){const e="personalaccount.html";window.location.href=e}function X(e){let t=document.querySelector(e),o=t.querySelector(".burger-menu__button",".burger-menu__lines"),n=t.querySelectorAll(".burger-menu__link"),l=t.querySelector(".burger-menu__overlay");o.addEventListener("click",c=>{c.preventDefault(),s()}),n.forEach(c=>{c.addEventListener("click",()=>s())}),l.addEventListener("click",()=>s());function s(){t.classList.toggle("burger-menu__active"),t.classList.contains("burger-menu__active")?(document.body.classList.add("toggle-hidden"),document.body.classList.remove("toggle-visible")):(document.body.classList.add("toggle-visible"),document.body.classList.remove("toggle-hidden"))}}const Y=document.querySelector("#btnOpen"),P=document.querySelector("#btnOpenBurger"),Z=document.querySelector("#personalAccount"),Q=document.querySelector(".burger-menu__exit");document.querySelector("#windModal");const V=document.querySelector("#btnClose");function L(){window.windModal.showModal(),document.body.classList.add("scroll-lock"),B.style.display="flex",x.style.display="none",k.style.display="none",I.style.display="none",g.value="",f.value=""}function W(){window.windModal.close(),document.body.classList.remove("scroll-lock")}Y.addEventListener("click",L);P.addEventListener("click",L);V.addEventListener("click",W);const ee=document.forms.loginForm,g=document.querySelector("#loginEmail"),f=document.querySelector("#loginPassword"),r=document.querySelector("#btnLogin"),_=document.querySelector(".account__personal"),q=document.querySelector(".account__exit");_.style.display="none";q.style.display="none";const C=document.querySelector("#hiNameUser"),u=document.querySelector(".account__enter");r.disabled=!0;function te(){if(localStorage.hasOwnProperty("client")===!0){u.style.display="none",_.style.display="flex",q.style.display="flex";const o=window.localStorage.getItem("client"),n=JSON.parse(o);C.textContent=` Привет, ${n.name}`,new Date().getTime()-n.time>30*24*60*60*1e3?(window.localStorage.removeItem("client"),u.style.display="flex"):(n.time=new Date().getTime(),window.localStorage.setItem("client",JSON.stringify(n)))}else u.style.display="flex";new URLSearchParams(window.location.search).get("login")&&!localStorage.hasOwnProperty("client")&&L()}window.addEventListener("load",te);ee.addEventListener("submit",e=>{e.preventDefault()});g.addEventListener("input",T);f.addEventListener("input",T);function T(){r.disabled=g.value==""||f.value==""}const ne=document.querySelector("#dialogEmailError"),oe=document.querySelector("#dialogPasswError");async function le(){r.disabled=!0;let e=h(f.value).toString();const t=await O("users","email",g.value);if(t.length==0)ne.textContent="Пользователь с таким email не зарегестрирован. Создайте свой аккаунт в форме регистрации";else if(t[0].password!=e)oe.textContent="пароль неверный";else{let o=new Date().getTime();const n={id:t[0].id,name:t[0].name,time:o},l=JSON.stringify(n);window.localStorage.setItem("client",l),window.windModal.close(),u.style.display="none",P.style.display="none",Q.style.display="flex",Z.style.display="flex",_.style.display="flex",q.style.display="flex";const s=window.localStorage.getItem("client"),c=JSON.parse(s);C.textContent=` Привет, ${c.name}`}r.disabled=!1}r.addEventListener("click",le);const m=document.getElementById("thirdPassword"),i=document.getElementById("thirdReappassword"),se=document.forms.thirdForm,w=document.querySelector("#secondEmail"),S=document.querySelector("#secondSecret"),a=document.querySelector("#secondBtn");a.disabled=!0;const p=document.querySelector("#thirdBtn");p.disabled=!0;function $(){let e=!0;return/^(?=.*\d)(?=.*[!@#$%^&*])(?=.*[a-z])(?=.*[A-Z]).{8,}$/.test(m.value)||(e=!1,document.getElementById("thirdPasswordErr").innerHTML=" Пароль должен: содержать хотя бы одну большую букву, хотя бы одну маленькую букву, хотя бы одну цифру, хотя бы один спецсимвол(!@#$%^&*);"),i.value!==m.value&&(i.nextElementSibling.textContent="Пароли не совпадают",e=!1),e}se.addEventListener("submit",e=>{e.preventDefault(),$()});function N(){a.disabled=w.value==""||S.value==""}w.addEventListener("input",N);S.addEventListener("input",N);function j(){p.disabled=i.value==""||m.value==""}m.addEventListener("input",j);i.addEventListener("input",j);const ce=document.querySelector("#secondEmailErr"),re=document.querySelector("#secondSecretErr"),x=document.querySelector(".check-input"),k=document.querySelector(".new-pass"),I=document.querySelector(".ok-block"),B=document.querySelector(".main-form"),ie=document.querySelector("#newComwIn");let E="";const ae=document.querySelector("#passwordBtn");function de(){B.style.display="none",x.style.display="flex",w.value="",S.value=""}ae.addEventListener("click",de);async function ue(){a.disabled=!0;let e=h(S.value).toString();const t=await O("users","email",w.value);t.length==0?ce.textContent="Пользователь с таким email не зарегестрирован. Создайте свой аккаунт в форме регистрации":t[0].secret!=e?re.textContent="кодовое слово неверное":(x.style.display="none",k.style.display="flex",E=t[0].id),a.disabled=!1}a.addEventListener("click",ue);p.addEventListener("click",async()=>{if(!$())return;p.disabled=!0;const e={password:h(i.value).toString()};await A("users",E,e),E="",k.style.display="none",I.style.display="flex"});ie.addEventListener("click",()=>{I.style.display="none",B.style.display="flex"});
